# nram-lab-cron-codes

## Описание

Репозиторий с кодами для создания бекапов NRAM LAB, для запуска с помощью cron.
Планируется расширение. БЕЗ ЗАВИСИМОСТЕЙ, ЧИСТЫЙ ПИТОН.
На текущий момент умеет:

- Делать бекап compose.
- Делать бекап базы данных.
- Отправлять сообщение в телегу о том, что бекап сделан, с результатом.

Для запуска задач использовать скрипты .py.
Проверено на **python 3.12.3**

## Конфиги

Конфиги хранятся в корне в файле config.json
Содержимое файла config.json:

```javascript
{
  "bot_token": "12345:ABC...",
  "chat_ids": ["123456789", "987654321"],
  "compose_list": ["app1", "app2", "app3"],
  "db_container": "db1_container", 
  "db_path": "app/db"
}
```

## Шпаргалка cron

Cron использует синтаксис из 5 полей для планирования задач:

- минута (0-59), 
- час (0-23), 
- день месяца (1-31), 
- месяц (1-12), 
- день недели (0-7, где 0/7=воскресенье). 

После полей идет команда запуска.

### Управление cron
```bash
  crontab -e # редактировать задания текущего пользователя.
  crontab -l # просмотреть задания.
  crontab -r # удалить все задания.
```

### Синтаксис полей

- *    — любое значение
- ,    — список (0,5,10)
- -    — диапазон (1-5)
- */n  — шаг (каждые n, напр. */15)
- /n   — с начала периода шагом n (0/n)
- Директива L — последний день (для дней/месяцев).

### Специальные строки

- @reboot   — при загрузке
- @hourly   — ежечасно (0 * * * *)
- @daily    — ежедневно (0 0 * * *)
- @weekly   — еженедельно
- @monthly  — ежемесячно
- @yearly   — ежегодно

### Примеры:

```bash
# Приклад
# Бекап компосов в 8 утра каждого 10 числа месяца из текущего юзера
0 8 10 * * python3 ~/nram-lab-cron-codes/make_compose_backups.py

# бекап базы в 14-30 каждый день
30 14 * * * python3 ~/nram-lab-cron-codes/make_database_backup.py

# Теоретические примеры
# Каждую минуту
* * * * * /usr/bin/python3 /path/to/script.py >> /var/log/script.log 2>&1

# Каждый час
0 * * * * cd /path/to/dir && /path/to/venv/bin/python script.py

# Ежедневно в 3:00
0 3 * * * /usr/bin/python3 /home/user/script.py

# Каждые 15 мин по будням (1-5)
*/15 * * * 1-5 python3 /opt/task.py

# В 7:30 по воскресеньям
30 7 * * 0 /usr/bin/python3 /script.py
```
